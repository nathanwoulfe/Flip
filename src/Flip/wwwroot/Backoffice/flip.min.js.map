{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/Flip/Backoffice/flip.ts","src/Flip/Backoffice/js/flip.controller.ts","src/Flip/Backoffice/js/flip.resource.ts"],"names":[],"mappings":"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","file":"flip.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","﻿import { FlipResource } from './js/flip.resource';\r\nimport { FlipDialogController } from './js/flip.controller';\r\n\r\nconst ServicesModule = angular.module('flip.services', [])\r\n    .service(FlipResource.serviceName, FlipResource).name;\r\n\r\nconst ControllersModule = angular.module('flip.controllers', [])\r\n    .controller(FlipDialogController.controllerName, FlipDialogController).name;\r\n\r\nconst flip = 'flip';\r\n\r\nangular.module(flip, [\r\n    ServicesModule,\r\n    ControllersModule,\r\n]);\r\n\r\nangular.module('umbraco').requires.push(flip);","﻿export class FlipDialogController {\r\n\r\n    public static controllerName = 'Flip.Dialog.Controller';\r\n\r\n    loaded: boolean = false;\r\n    permittedTypes: Array<any> = [];\r\n    node: any;\r\n    newType: any;\r\n    mapType: 'EDITOR' | 'DATATYPE' = 'DATATYPE';\r\n    newTemplateId!: number;\r\n\r\n    newProperties = {};\r\n\r\n    mapTypeChange: Function;\r\n\r\n    constructor(\r\n        private flipResource: IFlipResource,\r\n        public $scope,\r\n        private navigationService,\r\n        private $window) {\r\n        this.mapTypeChange = $scope.$watch(() => this.mapType, () => {\r\n            this.newType ? this.getNewTypePropertyCollection() : {};\r\n        });\r\n    }\r\n\r\n    $onInit() {\r\n        this.flipResource.getContentModel(this.$scope.currentNode.id)\r\n            .then(node => {\r\n                this.node = node;\r\n                this.getPermittedTypes();\r\n            })\r\n    }\r\n\r\n    $onDestroy() {\r\n        this.mapTypeChange();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * */\r\n    getPermittedTypes() {\r\n        this.flipResource.getPermittedTypes(this.$scope.currentNode.id)\r\n            .then(result => {\r\n                this.permittedTypes = result.permittedTypes;\r\n                this.loaded = true;\r\n\r\n                if (this.permittedTypes.length === 1) {\r\n                    this.newType = this.permittedTypes[0];\r\n                    this.getNewTypePropertyCollection(true);\r\n                }\r\n            });\r\n    }\r\n\r\n    /**\r\n     * \r\n     * */\r\n    getNewTypePropertyCollection(setsNewType: boolean = false) {\r\n        this.newProperties = {};\r\n\r\n        if (setsNewType) {\r\n            this.newTemplateId = this.newType.DefaultTemplateId;\r\n        }\r\n\r\n        // clear to ensure no stale data after changing type or mapType\r\n        this.node.properties.forEach(prop => {\r\n            prop.newAlias = '';\r\n        });\r\n\r\n        // iterates over explict and composed properties\r\n        const propertyTypes = [\r\n            ...this.newType.ContentTypeComposition.map(x => x.PropertyGroups.map(y => y.PropertyTypes).flat()).flat(),\r\n            ...this.newType.PropertyGroups.map(x => x.PropertyTypes).flat()];\r\n\r\n        propertyTypes.forEach(type => {\r\n            const propertyKey = this.mapType === 'DATATYPE' ? type.DataTypeKey : type.PropertyEditorAlias;\r\n\r\n            if (!this.newProperties[propertyKey]) {\r\n                this.newProperties[propertyKey] = [{ dataTypeKey: '', editor: '', alias: '', label: '' }];\r\n            }\r\n\r\n            this.newProperties[propertyKey].push({\r\n                dataTypeKey: type.DataTypeKey,\r\n                editor: type.PropertyEditorAlias,\r\n                alias: type.Alias,\r\n                label: type.Name,\r\n            });\r\n\r\n            // also check that the current type has a matching property - match on datatype key\r\n            // to only allow matches on the exact data type, not the property editor as config may differ\r\n            // if so, set newAlias on the current type to ensure the value is mapped on save\r\n\r\n            // look for exact match by alias first, then check for broader match\r\n            let existingProperty = this.node.properties.find(p => p.alias === type.Alias &&\r\n                (this.mapType === 'DATATYPE' ? p.dataTypeKey === type.DataTypeKey : p.editor === type.PropertyEditorAlias));\r\n\r\n            existingProperty = existingProperty ?? this.node.properties.find(p => this.mapType === 'DATATYPE' ? p.dataTypeKey === type.DataTypeKey : p.editor === type.PropertyEditorAlias);\r\n\r\n            if (existingProperty) {\r\n                existingProperty.newAlias = type.Alias;\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * \r\n     * */\r\n    close() {\r\n        this.navigationService.hideDialog();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * */\r\n    save() {\r\n        this.flipResource.changeContentType(this.$scope.currentNode.id, this.newType.Id, this.newTemplateId || this.newType.DefaultTemplateId, this.node.properties)\r\n            .then(result => {\r\n                this.$window.location.reload();\r\n            });\r\n    }\r\n}","﻿import { IHttpService } from \"angular\";\r\n\r\nexport class FlipResource implements IFlipResource {\r\n\r\n    public static serviceName = 'flipResource';\r\n\r\n    private _apiBaseUrl = Umbraco.Sys.ServerVariables.Flip.apiBaseUrl;\r\n\r\n    constructor(private $http: IHttpService, private umbRequestHelper) { }\r\n\r\n    private _request = (method: 'POST' | 'GET', url: string, errorMessage: string = 'Something broke', data?: object) =>\r\n        this.umbRequestHelper.resourcePromise(\r\n                method === 'POST' ? this.$http.post(this._apiBaseUrl + url, data) : this.$http.get(this._apiBaseUrl + url),\r\n            errorMessage);\r\n\r\n    getPermittedTypes = nodeId => this._request('GET', `GetPermittedTypes?nodeId=${nodeId}`, 'Failed to retrieve permitted types for node id' + nodeId);\r\n\r\n    changeContentType = (nodeId: number, contentTypeId: number, templateId: number, properties: Array<IDocumentTypeProperty>) =>\r\n        this._request('POST', 'ChangeContentType', 'Failed to change document type for node id ' + nodeId, { nodeId, contentTypeId, templateId, properties });\r\n   \r\n    getContentModel = (nodeId: number) =>\r\n        this._request('GET', `GetContentModel?nodeId=${nodeId}`, 'Failed to get content type for node id ' + nodeId);\r\n}"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvRmxpcC9CYWNrb2ZmaWNlL2ZsaXAudHMiLCJzcmMvRmxpcC9CYWNrb2ZmaWNlL2pzL2ZsaXAuY29udHJvbGxlci50cyIsInNyYy9GbGlwL0JhY2tvZmZpY2UvanMvZmxpcC5yZXNvdXJjZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUMsc0RBQWtEO0FBQ25ELDBEQUE0RDtBQUU1RCxNQUFNLGNBQWMsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLGVBQWUsRUFBRSxFQUFFLENBQUM7S0FDckQsT0FBTyxDQUFDLDRCQUFZLENBQUMsV0FBVyxFQUFFLDRCQUFZLENBQUMsQ0FBQyxJQUFJLENBQUM7QUFFMUQsTUFBTSxpQkFBaUIsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLGtCQUFrQixFQUFFLEVBQUUsQ0FBQztLQUMzRCxVQUFVLENBQUMsc0NBQW9CLENBQUMsY0FBYyxFQUFFLHNDQUFvQixDQUFDLENBQUMsSUFBSSxDQUFDO0FBRWhGLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQztBQUVwQixPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRTtJQUNqQixjQUFjO0lBQ2QsaUJBQWlCO0NBQ3BCLENBQUMsQ0FBQztBQUVILE9BQU8sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzs7Ozs7QUNoQjdDLE1BQWEsb0JBQW9CO0lBZTlCLFlBQ1ksWUFBMkIsRUFDNUIsTUFBTSxFQUNMLGlCQUFpQixFQUNqQixPQUFPO1FBSFAsaUJBQVksR0FBWixZQUFZLENBQWU7UUFDNUIsV0FBTSxHQUFOLE1BQU0sQ0FBQTtRQUNMLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBQTtRQUNqQixZQUFPLEdBQVAsT0FBTyxDQUFBO1FBZm5CLFdBQU0sR0FBWSxLQUFLLENBQUM7UUFDeEIsbUJBQWMsR0FBZSxFQUFF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LElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxHQUFHLEdBQUcsQ0FBQyxFQUM5RyxZQUFZLENBQUMsQ0FBQztRQUV0QixzQkFBaUIsR0FBRyxNQUFNLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLDRCQUE0QixNQUFNLEVBQUUsRUFBRSxnREFBZ0QsR0FBRyxNQUFNLENBQUMsQ0FBQztRQUVwSixzQkFBaUIsR0FBRyxDQUFDLE1BQWMsRUFBRSxhQUFxQixFQUFFLFVBQWtCLEVBQUUsVUFBd0MsRUFBRSxFQUFFLENBQ3hILElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLG1CQUFtQixFQUFFLDZDQUE2QyxHQUFHLE1BQU0sRUFBRSxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxDQUFDLENBQUM7UUFFMUosb0JBQWUsR0FBRyxDQUFDLE1BQWMsRUFBRSxFQUFFLENBQ2pDLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLDBCQUEwQixNQUFNLEVBQUUsRUFBRSx5Q0FBeUMsR0FBRyxNQUFNLENBQUMsQ0FBQztJQWI1QyxDQUFDOztBQU4xRSxvQ0FvQkM7QUFsQmlCLHdCQUFXLEdBQUcsY0FBYyxDQUFDIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwi77u/aW1wb3J0IHsgRmxpcFJlc291cmNlIH0gZnJvbSAnLi9qcy9mbGlwLnJlc291cmNlJztcclxuaW1wb3J0IHsgRmxpcERpYWxvZ0NvbnRyb2xsZXIgfSBmcm9tICcuL2pzL2ZsaXAuY29udHJvbGxlcic7XHJcblxyXG5jb25zdCBTZXJ2aWNlc01vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdmbGlwLnNlcnZpY2VzJywgW10pXHJcbiAgICAuc2VydmljZShGbGlwUmVzb3VyY2Uuc2VydmljZU5hbWUsIEZsaXBSZXNvdXJjZSkubmFtZTtcclxuXHJcbmNvbnN0IENvbnRyb2xsZXJzTW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2ZsaXAuY29udHJvbGxlcnMnLCBbXSlcclxuICAgIC5jb250cm9sbGVyKEZsaXBEaWFsb2dDb250cm9sbGVyLmNvbnRyb2xsZXJOYW1lLCBGbGlwRGlhbG9nQ29udHJvbGxlcikubmFtZTtcclxuXHJcbmNvbnN0IGZsaXAgPSAnZmxpcCc7XHJcblxyXG5hbmd1bGFyLm1vZHVsZShmbGlwLCBbXHJcbiAgICBTZXJ2aWNlc01vZHVsZSxcclxuICAgIENvbnRyb2xsZXJzTW9kdWxlLFxyXG5dKTtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCd1bWJyYWNvJykucmVxdWlyZXMucHVzaChmbGlwKTsiLCLvu79leHBvcnQgY2xhc3MgRmxpcERpYWxvZ0NvbnRyb2xsZXIge1xyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgY29udHJvbGxlck5hbWUgPSAnRmxpcC5EaWFsb2cuQ29udHJvbGxlcic7XHJcblxyXG4gICAgbG9hZGVkOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBwZXJtaXR0ZWRUeXBlczogQXJyYXk8YW55PiA9IFtdO1xyXG4gICAgbm9kZTogYW55O1xyXG4gICAgbmV3VHlwZTogYW55O1xyXG4gICAgbWFwVHlwZTogJ0VESVRPUicgfCAnREFUQVRZUEUnID0gJ0RBVEFUWVBFJztcclxuICAgIG5ld1RlbXBsYXRlSWQhOiBudW1iZXI7XHJcblxyXG4gICAgbmV3UHJvcGVydGllcyA9IHt9O1xyXG5cclxuICAgIG1hcFR5cGVDaGFuZ2U6IEZ1bmN0aW9uO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgZmxpcFJlc291cmNlOiBJRmxpcFJlc291cmNlLFxyXG4gICAgICAgIHB1YmxpYyAkc2NvcGUsXHJcbiAgICAgICAgcHJpdmF0ZSBuYXZpZ2F0aW9uU2VydmljZSxcclxuICAgICAgICBwcml2YXRlICR3aW5kb3cpIHtcclxuICAgICAgICB0aGlzLm1hcFR5cGVDaGFuZ2UgPSAkc2NvcGUuJHdhdGNoKCgpID0+IHRoaXMubWFwVHlwZSwgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLm5ld1R5cGUgPyB0aGlzLmdldE5ld1R5cGVQcm9wZXJ0eUNvbGxlY3Rpb24oKSA6IHt9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgICRvbkluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5mbGlwUmVzb3VyY2UuZ2V0Q29udGVudE1vZGVsKHRoaXMuJHNjb3BlLmN1cnJlbnROb2RlLmlkKVxyXG4gICAgICAgICAgICAudGhlbihub2RlID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMubm9kZSA9IG5vZGU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldFBlcm1pdHRlZFR5cGVzKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgJG9uRGVzdHJveSgpIHtcclxuICAgICAgICB0aGlzLm1hcFR5cGVDaGFuZ2UoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFxyXG4gICAgICogKi9cclxuICAgIGdldFBlcm1pdHRlZFR5cGVzKCkge1xyXG4gICAgICAgIHRoaXMuZmxpcFJlc291cmNlLmdldFBlcm1pdHRlZFR5cGVzKHRoaXMuJHNjb3BlLmN1cnJlbnROb2RlLmlkKVxyXG4gICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wZXJtaXR0ZWRUeXBlcyA9IHJlc3VsdC5wZXJtaXR0ZWRUeXBlcztcclxuICAgICAgICAgICAgICAgIHRoaXMubG9hZGVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5wZXJtaXR0ZWRUeXBlcy5sZW5ndGggPT09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm5ld1R5cGUgPSB0aGlzLnBlcm1pdHRlZFR5cGVzWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0TmV3VHlwZVByb3BlcnR5Q29sbGVjdGlvbih0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBcclxuICAgICAqICovXHJcbiAgICBnZXROZXdUeXBlUHJvcGVydHlDb2xsZWN0aW9uKHNldHNOZXdUeXBlOiBib29sZWFuID0gZmFsc2UpIHtcclxuICAgICAgICB0aGlzLm5ld1Byb3BlcnRpZXMgPSB7fTtcclxuXHJcbiAgICAgICAgaWYgKHNldHNOZXdUeXBlKSB7XHJcbiAgICAgICAgICAgIHRoaXMubmV3VGVtcGxhdGVJZCA9IHRoaXMubmV3VHlwZS5EZWZhdWx0VGVtcGxhdGVJZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGNsZWFyIHRvIGVuc3VyZSBubyBzdGFsZSBkYXRhIGFmdGVyIGNoYW5naW5nIHR5cGUgb3IgbWFwVHlwZVxyXG4gICAgICAgIHRoaXMubm9kZS5wcm9wZXJ0aWVzLmZvckVhY2gocHJvcCA9PiB7XHJcbiAgICAgICAgICAgIHByb3AubmV3QWxpYXMgPSAnJztcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gaXRlcmF0ZXMgb3ZlciBleHBsaWN0IGFuZCBjb21wb3NlZCBwcm9wZXJ0aWVzXHJcbiAgICAgICAgY29uc3QgcHJvcGVydHlUeXBlcyA9IFtcclxuICAgICAgICAgICAgLi4udGhpcy5uZXdUeXBlLkNvbnRlbnRUeXBlQ29tcG9zaXRpb24ubWFwKHggPT4geC5Qcm9wZXJ0eUdyb3Vwcy5tYXAoeSA9PiB5LlByb3BlcnR5VHlwZXMpLmZsYXQoKSkuZmxhdCgpLFxyXG4gICAgICAgICAgICAuLi50aGlzLm5ld1R5cGUuUHJvcGVydHlHcm91cHMubWFwKHggPT4geC5Qcm9wZXJ0eVR5cGVzKS5mbGF0KCldO1xyXG5cclxuICAgICAgICBwcm9wZXJ0eVR5cGVzLmZvckVhY2godHlwZSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5S2V5ID0gdGhpcy5tYXBUeXBlID09PSAnREFUQVRZUEUnID8gdHlwZS5EYXRhVHlwZUtleSA6IHR5cGUuUHJvcGVydHlFZGl0b3JBbGlhcztcclxuXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5uZXdQcm9wZXJ0aWVzW3Byb3BlcnR5S2V5XSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5uZXdQcm9wZXJ0aWVzW3Byb3BlcnR5S2V5XSA9IFt7IGRhdGFUeXBlS2V5OiAnJywgZWRpdG9yOiAnJywgYWxpYXM6ICcnLCBsYWJlbDogJycgfV07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMubmV3UHJvcGVydGllc1twcm9wZXJ0eUtleV0ucHVzaCh7XHJcbiAgICAgICAgICAgICAgICBkYXRhVHlwZUtleTogdHlwZS5EYXRhVHlwZUtleSxcclxuICAgICAgICAgICAgICAgIGVkaXRvcjogdHlwZS5Qcm9wZXJ0eUVkaXRvckFsaWFzLFxyXG4gICAgICAgICAgICAgICAgYWxpYXM6IHR5cGUuQWxpYXMsXHJcbiAgICAgICAgICAgICAgICBsYWJlbDogdHlwZS5OYW1lLFxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIGFsc28gY2hlY2sgdGhhdCB0aGUgY3VycmVudCB0eXBlIGhhcyBhIG1hdGNoaW5nIHByb3BlcnR5IC0gbWF0Y2ggb24gZGF0YXR5cGUga2V5XHJcbiAgICAgICAgICAgIC8vIHRvIG9ubHkgYWxsb3cgbWF0Y2hlcyBvbiB0aGUgZXhhY3QgZGF0YSB0eXBlLCBub3QgdGhlIHByb3BlcnR5IGVkaXRvciBhcyBjb25maWcgbWF5IGRpZmZlclxyXG4gICAgICAgICAgICAvLyBpZiBzbywgc2V0IG5ld0FsaWFzIG9uIHRoZSBjdXJyZW50IHR5cGUgdG8gZW5zdXJlIHRoZSB2YWx1ZSBpcyBtYXBwZWQgb24gc2F2ZVxyXG5cclxuICAgICAgICAgICAgLy8gbG9vayBmb3IgZXhhY3QgbWF0Y2ggYnkgYWxpYXMgZmlyc3QsIHRoZW4gY2hlY2sgZm9yIGJyb2FkZXIgbWF0Y2hcclxuICAgICAgICAgICAgbGV0IGV4aXN0aW5nUHJvcGVydHkgPSB0aGlzLm5vZGUucHJvcGVydGllcy5maW5kKHAgPT4gcC5hbGlhcyA9PT0gdHlwZS5BbGlhcyAmJlxyXG4gICAgICAgICAgICAgICAgKHRoaXMubWFwVHlwZSA9PT0gJ0RBVEFUWVBFJyA/IHAuZGF0YVR5cGVLZXkgPT09IHR5cGUuRGF0YVR5cGVLZXkgOiBwLmVkaXRvciA9PT0gdHlwZS5Qcm9wZXJ0eUVkaXRvckFsaWFzKSk7XHJcblxyXG4gICAgICAgICAgICBleGlzdGluZ1Byb3BlcnR5ID0gZXhpc3RpbmdQcm9wZXJ0eSA/PyB0aGlzLm5vZGUucHJvcGVydGllcy5maW5kKHAgPT4gdGhpcy5tYXBUeXBlID09PSAnREFUQVRZUEUnID8gcC5kYXRhVHlwZUtleSA9PT0gdHlwZS5EYXRhVHlwZUtleSA6IHAuZWRpdG9yID09PSB0eXBlLlByb3BlcnR5RWRpdG9yQWxpYXMpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGV4aXN0aW5nUHJvcGVydHkpIHtcclxuICAgICAgICAgICAgICAgIGV4aXN0aW5nUHJvcGVydHkubmV3QWxpYXMgPSB0eXBlLkFsaWFzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBcclxuICAgICAqICovXHJcbiAgICBjbG9zZSgpIHtcclxuICAgICAgICB0aGlzLm5hdmlnYXRpb25TZXJ2aWNlLmhpZGVEaWFsb2coKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFxyXG4gICAgICogKi9cclxuICAgIHNhdmUoKSB7XHJcbiAgICAgICAgdGhpcy5mbGlwUmVzb3VyY2UuY2hhbmdlQ29udGVudFR5cGUodGhpcy4kc2NvcGUuY3VycmVudE5vZGUuaWQsIHRoaXMubmV3VHlwZS5JZCwgdGhpcy5uZXdUZW1wbGF0ZUlkIHx8IHRoaXMubmV3VHlwZS5EZWZhdWx0VGVtcGxhdGVJZCwgdGhpcy5ub2RlLnByb3BlcnRpZXMpXHJcbiAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLiR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG59Iiwi77u/aW1wb3J0IHsgSUh0dHBTZXJ2aWNlIH0gZnJvbSBcImFuZ3VsYXJcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBGbGlwUmVzb3VyY2UgaW1wbGVtZW50cyBJRmxpcFJlc291cmNlIHtcclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIHNlcnZpY2VOYW1lID0gJ2ZsaXBSZXNvdXJjZSc7XHJcblxyXG4gICAgcHJpdmF0ZSBfYXBpQmFzZVVybCA9IFVtYnJhY28uU3lzLlNlcnZlclZhcmlhYmxlcy5GbGlwLmFwaUJhc2VVcmw7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSAkaHR0cDogSUh0dHBTZXJ2aWNlLCBwcml2YXRlIHVtYlJlcXVlc3RIZWxwZXIpIHsgfVxyXG5cclxuICAgIHByaXZhdGUgX3JlcXVlc3QgPSAobWV0aG9kOiAnUE9TVCcgfCAnR0VUJywgdXJsOiBzdHJpbmcsIGVycm9yTWVzc2FnZTogc3RyaW5nID0gJ1NvbWV0aGluZyBicm9rZScsIGRhdGE/OiBvYmplY3QpID0+XHJcbiAgICAgICAgdGhpcy51bWJSZXF1ZXN0SGVscGVyLnJlc291cmNlUHJvbWlzZShcclxuICAgICAgICAgICAgICAgIG1ldGhvZCA9PT0gJ1BPU1QnID8gdGhpcy4kaHR0cC5wb3N0KHRoaXMuX2FwaUJhc2VVcmwgKyB1cmwsIGRhdGEpIDogdGhpcy4kaHR0cC5nZXQodGhpcy5fYXBpQmFzZVVybCArIHVybCksXHJcbiAgICAgICAgICAgIGVycm9yTWVzc2FnZSk7XHJcblxyXG4gICAgZ2V0UGVybWl0dGVkVHlwZXMgPSBub2RlSWQgPT4gdGhpcy5fcmVxdWVzdCgnR0VUJywgYEdldFBlcm1pdHRlZFR5cGVzP25vZGVJZD0ke25vZGVJZH1gLCAnRmFpbGVkIHRvIHJldHJpZXZlIHBlcm1pdHRlZCB0eXBlcyBmb3Igbm9kZSBpZCcgKyBub2RlSWQpO1xyXG5cclxuICAgIGNoYW5nZUNvbnRlbnRUeXBlID0gKG5vZGVJZDogbnVtYmVyLCBjb250ZW50VHlwZUlkOiBudW1iZXIsIHRlbXBsYXRlSWQ6IG51bWJlciwgcHJvcGVydGllczogQXJyYXk8SURvY3VtZW50VHlwZVByb3BlcnR5PikgPT5cclxuICAgICAgICB0aGlzLl9yZXF1ZXN0KCdQT1NUJywgJ0NoYW5nZUNvbnRlbnRUeXBlJywgJ0ZhaWxlZCB0byBjaGFuZ2UgZG9jdW1lbnQgdHlwZSBmb3Igbm9kZSBpZCAnICsgbm9kZUlkLCB7IG5vZGVJZCwgY29udGVudFR5cGVJZCwgdGVtcGxhdGVJZCwgcHJvcGVydGllcyB9KTtcclxuICAgXHJcbiAgICBnZXRDb250ZW50TW9kZWwgPSAobm9kZUlkOiBudW1iZXIpID0+XHJcbiAgICAgICAgdGhpcy5fcmVxdWVzdCgnR0VUJywgYEdldENvbnRlbnRNb2RlbD9ub2RlSWQ9JHtub2RlSWR9YCwgJ0ZhaWxlZCB0byBnZXQgY29udGVudCB0eXBlIGZvciBub2RlIGlkICcgKyBub2RlSWQpO1xyXG59Il19"}